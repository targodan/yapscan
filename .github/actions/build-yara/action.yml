name: 'Build yara'
description: 'Builds yara'
inputs:
    yara-version:
        description: "Yara version"
        required: true
runs:
    using: "composite"
    steps:
        - name: Install yara dependencies
          run: sudo apt-get update && sudo apt-get install -y libssl-dev libprotobuf-dev flex bison
        - name: Cache libyara
          uses: actions/cache@v2
          id: yara-cache
          with:
              key: ${{ runner.os }}-yara-${{ inputs.yara-version }}
              path: deps
        - name: Build libyara
          run: |
              git clone --depth=1 --branch ${{ inputs.yara-version }} https://github.com/VirusTotal/yara.git deps/yara
              cd deps/yara
              ./bootstrap.sh
              ./configure --prefix=/usr --with-crypto || exit $?
              make -j
          if: steps.yara-cache.outputs.cache-hit != 'true'
        - name: Install libyara
          run: sudo make install
          working-directory: deps/yara
